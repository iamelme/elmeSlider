<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Elme Slider</title>
</head>
<body>
    <div class="slider">
        <div class="slider__inner">
            <div class="slider__item">
                <img src="img/1.jpg" alt="">
            </div>
            <div class="slider__item ">
                <img src="img/2.jpg" alt="">
            </div>
            <div class="slider__item ">
                <img src="img/3.jpg" alt="">
            </div>
            <div class="slider__item">
                <img src="img/4.jpg" alt="">
            </div>
        </div>

        <button class="nav prev">Prev</button>
        <button class="nav next">Next</button>
    </div>

    <script>
        'use strict';

        window.onload = () => {
            let sliderContainer = document.querySelector('.slider__inner'),
                slides = document.querySelectorAll('.slider__item'),
                navBtn = document.querySelectorAll('.nav'),
                navTemplate = `<div class="paginate"></div>`,
                mainSlider = document.querySelector('.slider'),
                widthContainer = 0,
                slidesArrCoorX = [0],
                coordX,
                currentIdx = 0;

                sliderContainer.style.opacity = 1;
                mainSlider.insertAdjacentHTML('beforeend', `<div class="paginate"></div>`);

                slides.forEach(e => {
                    widthContainer += e.offsetWidth;
                });

                sliderContainer.style.width = `${widthContainer}px`; // initial width

                let slidesWidth = 0;

                slides.forEach((e, idx) => {
                    if(e.className.indexOf('current') !== -1) {
                        currentIdx = idx;
                    }
                    if(idx < slides.length - 1) {
                        slidesWidth = e.getBoundingClientRect().width + slidesWidth;
                        slidesArrCoorX.push(slidesWidth);
                    }

                    document.querySelector('.paginate').innerHTML += `<span class="pagi__item"></span>`;
                });

                let pagiItem = document.querySelectorAll('.pagi__item');
                
                slides[0].classList.add('current');
                pagiItem[0].classList.add('active');
                console.log(currentIdx +' <--- index outside');

                console.log(slidesArrCoorX);

                function coords() {
                    console.log(slidesArrCoorX);
                    
                    slides.forEach((e, idx) => {
                        if(e.className.indexOf('current') !== -1) {
                            e.classList.remove('current');
                            pagiItem[idx].classList.remove('active');
                            currentIdx = idx;
                        }
                    });
                    console.log(currentIdx +' <--- index');               
                    console.log(slidesArrCoorX[currentIdx]);
                    if(this.className.indexOf('next') !== -1){
                        nextSlides();
                    } else {
                        if(currentIdx == 0) {
                            slides[slides.length -1].classList.add('current');
                            pagiItem[slides.length -1].classList.add('active');
                            currentIdx = slides.length -1;
                            coordX = slidesArrCoorX[currentIdx];

                            currentIdx = currentIdx -1;
                        }
                        else {
                            slides[currentIdx - 1].classList.add('current');      
                            pagiItem[currentIdx - 1].classList.add('active');      
                            coordX = slidesArrCoorX[currentIdx -1];
                
                        }   
                    }
                    sliderContainer.style.transform = `translateX(-${ coordX }px)`;
                }
                

               

                function nextSlides() {
                    coordX = slidesArrCoorX[currentIdx + 1];
                    if(currentIdx < slides.length -1) {
                        slides[currentIdx + 1].classList.add('current');
                        pagiItem[currentIdx + 1].classList.add('active');
                    } else {
                        slides[0].classList.add('current');
                        pagiItem[0].classList.add('active');
                        sliderContainer.style.transform = `translateX(-0px)`;
                    }
                }
                
                setInterval(()=>{

                    slides.forEach((e, idx) => {
                        if(e.className.indexOf('current') !== -1) {
                            e.classList.remove('current');
                            currentIdx = idx;
                            pagiItem[currentIdx].classList.remove('active');
                        }
                    });
                
                    coordX = slidesArrCoorX[currentIdx + 1];
                    if(currentIdx < slides.length -1) {
                        slides[currentIdx + 1].classList.add('current');                        
                        pagiItem[currentIdx + 1].classList.add('active');                        
                    } else {
                        slides[0].classList.add('current');
                        pagiItem[0].classList.add('active');
                        sliderContainer.style.transform = `translateX(-0px)`;
                    }
                    if(currentIdx < slides.length -1) {
                        currentIdx++;
                    } else {
                        currentIdx = 0;
                    }

                    sliderContainer.style.transform = `translateX(-${ coordX }px)`;
                }, 3000);
                


                pagiItem.forEach(e=>{
                    console.log(e);
                })

                navBtn.forEach(e=>e.addEventListener('click', coords));

                // let w = 0;
                // function testz(e) {
                //     e.preventDefault();
                //     clearInterval();
                //     var touchObj = e.changedTouches[0];

                //     console.log(touchObj.clientX - w);
                // }

                // sliderContainer.addEventListener('touchmove', testz, false);
        }

    </script>
</body>
</html>